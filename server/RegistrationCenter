package com.iit.cao.pa3.Server;

import com.iit.cao.pa3.database.bean.Server;
import com.iit.cao.pa3.database.dao.ServerDao;
import com.iit.cao.pa3.database.impl.ServerDaoImpl;
import com.iit.cao.pa3.utils.JdbcUtil;

import java.sql.Connection;

public class RegistrationCenter {

    private final ServerDao dao = new ServerDaoImpl();

    /**
     * 注册服务，即将服务的相关信息插入server表中
     * @param serverName
     * @param serverIp
     * @param serverPort
     * @param status
     * @param service
     */
    public void registerServer(String serverName, String serverIp, Integer serverPort, String status, String service) {
        Connection conn = null;
        try {
            conn = JdbcUtil.getConnection();
            Server server = new Server(null, serverName, serverIp, serverPort, status, service);
            Server originalServer = dao.getOriginalServer(conn, server);
            if (originalServer == null) {
                dao.insert(conn, server);
            }
        } catch (Exception ex) {
            ex.printStackTrace();
        } finally {
            JdbcUtil.closeResource(conn, null, null);
        }
    }

    /**
     * 通过 serverName 和 serviceName 获取已注册服务
     * @param serverName: 已注册服务名称
     * @param serviceName: 已注册服务所属类的名称
     * @return 已注册的服务
     */
    public Server subscribe(String serverName, String serviceName) {
        Connection conn = null;
        try {
            conn = JdbcUtil.getConnection();
            return dao.getServerByNameAndService(conn, serverName, serviceName);
        } catch (Exception ex) {
            ex.printStackTrace();
        } finally {
            JdbcUtil.closeResource(conn, null, null);
        }
        return null;
    }

}
